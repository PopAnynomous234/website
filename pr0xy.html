<!DOCTYPE html>
<html>
<head>
    <title>Ultraviolet Proxy</title>
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux@2.0.4/dist/index.js"></script>

    <style>
        body { background: #111; margin: 0; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
        .ui { padding: 20px; text-align: center; background: #222; }
        input { padding: 10px; width: 50%; border-radius: 5px; border: none; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        iframe { flex-grow: 1; border: none; width: 100%; background: white; }
    </style>
</head>
<body>

    <div class="ui">
        <input type="text" id="url" placeholder="Enter URL...">
        <button id="go">GO</button>
    </div>

    <iframe id="display"></iframe>

    <script>
        async function init() {
            try {
                // 1. Setup the transport
                const connection = new BareMux.BareMuxConnection('https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux@2.0.4/dist/worker.js');
                await connection.setTransport('https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux@2.0.4/dist/index.mjs', ['https://legendary-doodle-4j5jj5r566qrhqx79-8080.app.github.dev/v3/']);
                
                // 2. Register the Service Worker from ROOT
                if ('serviceWorker' in navigator) {
                    await navigator.serviceWorker.register('/sw.js', { 
                        scope: '/uv/service/' 
                    });
                    console.log("Service Worker Active");
                }
            } catch (err) {
                console.error("Init Failed:", err);
            }
        }

        document.getElementById('go').onclick = async () => {
            const input = document.getElementById('url').value;
            const frame = document.getElementById('display');
            
            if (!input) return;

            let target = input.includes('.') ? input : 'https://www.google.com/search?q=' + encodeURIComponent(input);
            if (!target.startsWith('http')) target = 'https://' + target;

            // Encode and load
            frame.src = __uv$config.prefix + __uv$config.encodeUrl(target);
        };

        // Start the init process
        init();
    </script>
</body>
</html>
